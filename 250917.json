[
  {
    "bookSourceComment": "基于 PyFQWeb 项目开发的 Legado 兼容书源\n/*\n搜索模式默认是搜书\n需要漫画则在关键字前加m:即m:系统\n听书则为t:系统 \n短剧则为d:系统\n*/",
    "bookSourceName": "🍅 番茄2.0",
    "bookSourceType": 0,
    "bookSourceUrl": "整合书源来源者:Buding\n发现页提供来源:阿鹏\n书源接口提供者:十安\n书源维护修复者:清词\n本书源支持功能:\n1.番茄小说，番茄听书，番茄漫画，番茄短剧\n2.支持利用书籍ID搜小黑屋书籍！\n书源特别说明词:\n1.禁止下载，否则一人下载全员遭殃！\n2.预下载调个四五章也可以，只要不高速请求，不下载理论小说和漫画正文不会有问题！\n(哪怕你下载，听书和短剧依然能用！)\n3.如果忍不住，最好预下载调个四五章也可以，只要不高速请求！",
    "bookUrlPattern": "https?://.*(fqnovel|snssdk|fanqienovel|changdunovel|sukimon|ttdndd|qkg1)\\.(top|com|me).*[0-9]{19}.*",
    "customOrder": -2,
    "enabled": true,
    "enabledCookieJar": true,
    "enabledExplore": true,
    "exploreUrl": "@js:\n个人中心 = 1\n\njs = (cid, genre, gender) => `@js:\ngetApi() + \"/reading/bookapi/new_category/landing/v/?\" + [\n    \"category_id=${cid}\",\n    \"limit=20\",\n    \"offset=\" + (page - 1),\n    \"gender=${gender}\",\n    \"genre=${genre}\"\n  ].join(\"&\")`\n\nobj = (title, url, type) => ({\n  title: title,\n  url: url,\n  style: {\n    layout_flexGrow: 1,\n    layout_flexBasisPercent: type\n  }\n})\n\narr = []\njava.longToast(\"请稍等，发现列表正在热更新！\")\nindex=[0, 1, 2]\nfor (let i of index) {\n  // java.toast(i)\n  let type = i\n  $ = JSON.parse(java.ajax(getApi() + \"/reading/bookapi/new_category/front/v/?\" + [\n      \"update_version_code=58932\",\n      \"distinct_style=1\",\n      \"new_category_tab=\" + i\n    ].join(\"&\")\n  )).data.category_tab_data\n  cate = []\n  cate.push(obj(\n    \"====== \" + $.tab_name + \" ======\", \"\", 1\n  ))\n  $.cell_data.forEach((c) => {\n    gender_1 = (type == 0 || type == 1) ? 2 : 1;\n    genre_1 = type == 2 ? 2 : type == 3 ? 1 : type == 5 ? 110 : type == 6 ? 130 : 0;\n    cate.push(obj(\n      c.cell_name,\n      js(c.atom_data[0].category_data.category_id, genre_1, gender_1),\n      1\n    ))\n    for (j = 2; j < 5; j++) {\n      c.atom_data.slice(1).forEach((a) => {\n        d = a.category_data\n        if (d.name.length == j) {\n          cate.push(obj(d.name, js(d.category_id, genre_1, gender_1), -1))\n        }\n      })\n    }\n  })\n  arr = cate.concat(arr)\n}\n\nlet book_shelf_url = 'https://fanqienovel.com/reading/bookapi/bookshelf/info/v:version/?aid=1967&iid=0&version_code=57700&update_version_code=57700' \nlet book_shelf_info = JSON.parse(java.ajax(book_shelf_url + ', ' + JSON.stringify({\n  headers: {\n    'Cookie': \"sessionid=\" + (String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap() ? source.getLoginInfoMap() : {})['手动登录Token']),\n  }\n})))\n\njava.log(JSON.stringify(book_shelf_info))\n\nlet username\nif (book_shelf_info.code != 0) {\n  个人中心 = 0\n} else {\n  let uinfo = java.ajax(\"https://fanqienovel.com/api/user/info/v2,\" + JSON.stringify({ headers: { Cookie: \"sessionid=\" + (String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap() ? source.getLoginInfoMap() : {})['手动登录Token']) }}))\n  uinfo = JSON.parse(uinfo)\n  username = uinfo.data.name\n}\n\nlet gro = []\npush = (title, url, type) => gro.push({\n  title: title,\n  url: url,\n  style: {\n    layout_flexGrow: 1,\n    layout_flexBasisPercent: type\n  }\n});\n\nlet sArr = []\n\nif (个人中心) {\n  let groups_bookids = {\n    \"未分组\": []\n  }\n  book_shelf_info.data.book_shelf_info.forEach(i => {\n    if (!groups_bookids[i.group_name ? i.group_name : \"未分组\"]) groups_bookids[i.group_name] = []\n    groups_bookids[i.group_name ? i.group_name : \"未分组\"].push(i.book_id)\n  })\n\n  Object.keys(groups_bookids).forEach(k => {\n    var multi_detail_post_body = {\n      data: {\n        book_shelf_info: []\n      }\n    }\n    groups_bookids[k].forEach(i => multi_detail_post_body.data.book_shelf_info.push({ book_id: String(i), item_id: '0' }))\n    // var multi_detail_group_url = `https://fanqienovel.com/api/bookshelf/multidetail,${JSON.stringify(multi_detail_post_body)}` \n    // var book_ids = getBookId(JSON.stringify(multi_detail_post_body)).join(\",\") \n    push(k, \"https://fanqienovel.com/fqbookshelf/groupName/\" + k, 0.4)\n  })\n  if (Object.keys(groups_bookids).length % 2 != 0) push(\"占位\", \"\", 0.4)\n  // java.log(JSON.stringify(gro, null, 2))\n  sArr.push(obj(username + '的个人中心', '', 1))\n  // sArr.push(obj('首页推荐', \"https://fanqienovel.com/tab/0\", 0.4))\n  // sArr.push(obj('猜你喜欢', \"https://fanqienovel.com/tab/1\", 0.4))\n  // sArr.push(obj('猜你喜欢', \"https://fanqienovel.com/tab/1\", 0.4))\n  sArr.push(obj(\"我的书架\", \"https://fanqienovel.com/fqbookshelf\", 1))\n  \n  sArr = sArr.concat(gro)\n  // java.toast(JSON.stringify(sArr)) \n  sArr.push(obj(\"阅读历史\",\"https://fanqienovel.com/reading/bookapi/read_history/list/v/?aid=1967&app_name=novelapp&channel=0&iid=1&offset={{(page-1)*100}}&os_version=12&version_code=59732,\" + JSON.stringify({ headers: { Cookie: \"sessionid=\" + (String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap() ? source.getLoginInfoMap() : {})['手动登录Token']) }}), 1))\n}\n\narr = sArr.concat(arr)\nJSON.stringify(arr)\n",
    "jsLib": "\n\n\n  function getHost() {\r\n    const { java, source, book } = this;\r\n    let loginInfoMap = source.getLoginInfoMap();\n    let apikey = \"https://fq.xo0x.cn\"; \r\n    if (loginInfoMap && loginInfoMap['域名'] && loginInfoMap['域名'] !== \"\" &&  loginInfoMap['域名'].includes('0')) {\r\n        apikey = loginInfoMap['域名'];\r\n \r\n    }\r\n    return apikey;\r\n}\n\n\n\n\nlet replaceCover = (u) => {\n    if (u.startsWith(\"https://\")) u = u.substring(8)\n    else u = u.substring(7)\n    let uArr = u.split(\"/\")\n    uArr[0] = \"https://p6-novel.byteimg.com/origin\"\n    let uArr2 = []\n    uArr.forEach((x) => {\n        if (!x.includes(\"?\") && !x.includes(\"~\")) uArr2.push(x)\n        else uArr2.push(x.split(\"~\")[0])\n    })\n    u = uArr2.join(\"/\")\n    return u\n}\n\nfunction splitArray(input, size) {\n  const output = []\n  for (let i = 0; i < input.length; i += size) {\n    output.push(input.slice(i, i + size))\n  }\n  return output\n}\n\nfunction getNovelComment(book_id, type) {\n    const { java, source, book } = this\n    if (type == 0) {\n    let count = book.getVariable(\"custom\")\n    if (count && count == \"\") count = 20\n    let res = java.ajax(`https://changdunovel.com/reading/ugc/novel_comment/book/v1?query_type=0&offset=0&count=${count}&sort=create_time&need_hot_comment=0&book_id=${book_id}&aid=1967&addQueryPrefix=true`) \n    let comments = JSON.parse(res).data.comment\n    let result = `${comments.length>0?(\"(共 \"+ comments.length +\" 条)\"):\"\"}\\n`\n    comments.forEach(c => {\n        let startNum = 5 - parseInt(c.score/2)\n        result += `${c.user_info.gender==1?\"👨🏻\":\"👱🏻\"} ${c.user_info.user_name} || ${\"★★★★★★☆☆☆☆☆\".slice(startNum, startNum + 5)}\\n${c.text.replace(/###/,\"\")}\\n&lrm;\\n`\n    })\n    return result\n    } \n  let result = \"\"\n  return result\n}\n\nfunction getApi() {\n  return \"http://49.232.25.145:14514\"\n}",
    "lastUpdateTime": 1757820906637,
    "loginCheckJs": "if (source.getVariable()==\"\") {\n    eval(String(source.loginUrl));\n    reg(true);\n}\nresult",
    "loginUi": "[\n{\n  \"name\": \"域名\",\n  \"type\": \"text\",\n  \"action\": \"\"\n},\n{\n  \"name\": \"手动登录Token\",\n  \"type\": \"password\",\n  \"action\": \"\"\n},\n\n\n{\n  \"name\": \"注册设备(能正常使用别点)\",\n  \"type\": \"button\",\n  \"action\": \"激活设备()\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 1.45\n  }\n},\n{\n  \"name\": \"查看教程\",\n  \"type\": \"button\",\n  \"action\": \"tutorial()\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.45\n  }\n},\n\n\n{\n  \"name\": \"查看Token\",\n  \"type\": \"button\",\n  \"action\": \"logToken()\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.45\n  }\n},\n{\n  \"name\": \"账号登录\",\n  \"type\": \"button\",\n  \"action\": \"l2(true)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.45\n  }\n},\n{\n  \"name\": \"退出登录\",\n  \"type\": \"button\",\n  \"action\": \"logout()\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.45\n  }\n},\n{\n'action': \"yu()\",\n'name': '当前模式',\n'type': 'button',\n\"style\": {\n\"layout_flexGrow\": 1,\n\"layout_flexBasisPercent\": 1\n}\n},\n{\n'action': \"settype('小说模式')\",\n'name': '小说模式',\n'type': 'button',\n\"style\": {\n\"layout_flexGrow\": 1,\n\"layout_flexBasisPercent\": 0.39\n}\n},\n\n{\n'action': \"settype('听书模式')\",\n'name': '听书模式',\n'type': 'button',\n\"style\": {\n\"layout_flexGrow\": 1,\n\"layout_flexBasisPercent\": 0.39\n}\n},\n{\n'action': \"settype('漫画模式')\",\n'name': '漫画模式',\n'type': 'button',\n\"style\": {\n\"layout_flexGrow\": 1,\n\"layout_flexBasisPercent\": 0.39\n}\n},\n{\n'action': \"settype('短剧模式')\",\n'name': '短剧模式',\n'type': 'button',\n\"style\": {\n\"layout_flexGrow\": 1,\n\"layout_flexBasisPercent\": 0.39\n}\n},\n\n\n{\n  \"name\": \"查询模式\",\n  \"type\": \"button文字关闭\",\n  \"action\": \"get()\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n  \"name\": \"阅读模式\",\n  \"type\": \"button\",\n  \"action\": \"set(0)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.45\n  }\n},\n{\n  \"name\": \"切换模式\",\n  \"type\": \"button\",\n  \"action\": \"st()\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.45\n  }\n},\n{\n  \"name\": \"多人对话\",\n  \"type\": \"button\",\n  \"action\": \"set(1)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n  \"name\": \"真人发音\",\n  \"type\": \"button\",\n  \"action\": \"set(2)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n  \"name\": \"甜美少女\",\n  \"type\": \"button\",\n  \"action\": \"set(3)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n  \"name\": \"清亮青叔\",\n  \"type\": \"button\",\n  \"action\": \"set(4)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n  \"name\": \"成熟大叔\",\n  \"type\": \"button\",\n  \"action\": \"set(5)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n  \"name\": \"开朗青年\",\n  \"type\": \"button\",\n  \"action\": \"set(6)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n  \"name\": \"温柔淑女\",\n  \"type\": \"button\",\n  \"action\": \"set(7)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n  \"name\": \"风雅青叔\",\n  \"type\": \"button\",\n  \"action\": \"set(8)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n  \"name\": \"清纯少女\",\n  \"type\": \"button\",\n  \"action\": \"set(9)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n  \"name\": \"磁性青叔\",\n  \"type\": \"button\",\n  \"action\": \"set(10)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n  \"name\": \"儒雅大叔\",\n  \"type\": \"button\",\n  \"action\": \"set(11)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n  \"name\": \"优雅御姐\",\n  \"type\": \"button\",\n  \"action\": \"set(12)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n  \"name\": \"斯文青叔\",\n  \"type\": \"button\",\n  \"action\": \"set(13)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n  \"name\": \"知性主播\",\n  \"type\": \"button\",\n  \"action\": \"set(14)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n  \"name\": \"成熟升级\",\n  \"type\": \"button\",\n  \"action\": \"set(15)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n  \"name\": \"多人升级\",\n  \"type\": \"button\",\n  \"action\": \"set(16)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n  \"name\": \"俏皮御姐\",\n  \"type\": \"button\",\n  \"action\": \"set(17)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n  \"name\": \"双音灵动\",\n  \"type\": \"button\",\n  \"action\": \"set(18)\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 0.25\n  }\n},\n{\n  \"name\": \"祝你天天开心哇 书源接口by: 梓澄qwq\",\n  \"type\": \"button\",\n  \"action\": \"t()\",\n  \"style\": {\n    \"layout_flexGrow\": 1,\n    \"layout_flexBasisPercent\": 1\n  }\n}\n]",
    "loginUrl": "\n\n\nfunction 激活设备() {\tjava.startBrowserAwait('https://fq.xo0x.cn/api/index.php?api=device_register&action=register', \"激活设备\");\n}\n\n\nfunction login(){};\n\tif (source.getVariable()==\"\") {\n    \n    reg(true);\n    }\n    \nvar lists = JSON.parse(source.getVariable());\nfunction settype(Type) {\n    lists.type = Type;\n  if (Type == '小说模式') {\n        lists.module = \"3\";\n    }else\n    \n    if (Type == '听书模式') {\n        lists.module = \"2\";\n    }else\n    \n    \n    if (Type == '漫画模式') {\n        lists.module = \"8\";\n    }else\n    \n     if (Type == '短剧模式') {\n        lists.module = \"11\";\n    };\n    source.setVariable(JSON.stringify(lists, null, \"\\t\"));\n    java.toast('已将类型切换为:\\n' + Type);\n}\nyu=()=>{\nu=JSON.parse(source.getVariable()).type;\njava.toast(`\\n${u}`)\n}\n\n\n\n// 登录及登录检查\nfunction login_(openBrowser, checkMode) {\n    // java.removeCookie(\"snssdk.com\")\n    var cookie_ = String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap() ? source.getLoginInfoMap() : {})['手动登录Token']\n    // java.toast(cookie_)\n    if (cookie_ && cookie_ != \"\" && !checkMode) {\n        if (!source.variableComment) {\n            java.toast(\"请不要重复登录，请先退出登录！\")\n        } else {\n            java.toast(\"您为填写token登录，请手动移除token后再次登录\")\n        }\n        return false\n    }\n    if (openBrowser) {\n        try {\n            java.startBrowserAwait(\"https://fanqienovel.com/\", \"登录\")\n        } catch (e) {\n            java.toast(e)\n        }\n    }\n    // java.log(\"snssdk cookie: \" + java.getCookie(\"snssdk.com\") + \"will be reomved\")\n    try {\n        cookie.removeCookie(\"snssdk.com\")\n    } catch (e) {}\n    // java.log(cookie)\n    var cookie_ = \"sessionid=\" + (String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap())['手动登录Token'])\n    let user\n    try {\n      user = JSON.parse(java.ajax(\"https://fanqienovel.com/api/user/info/v2,\" + JSON.stringify({\n        method: \"GET\",\n        headers: {\n          \"Cookie\": cookie_\n        }\n      }))).data.name\n     java.log(JSON.stringify(user))\n     } catch (e) {java.log(e)}\n    if (!cookie_ || cookie_ == \"sessionid=\" || !user) {\n        java.toast(\"未获取到登录凭据，登录失败\")\n        return false\n    }\n    java.toast(\"欢迎 \" + user + \"\\n登录成功！\")\n    return true\n}\n\nfunction login() // 一定程度上加上这个函数能够支持更多的版本\n{}\n\nfunction l2(a, b) {\n  try {\n    login_(a, b)\n  } catch (e) {\n    java.log(e+\"\\n\"+e.stack)\n  }\n}\n\n// 取消登录\nfunction logout() {\n    cookie.removeCookie(\"fanqienovel.com\");\n    cookie.removeCookie(\"snssdk.com\");\n    if (String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap() ? source.getLoginInfoMap() : {})['手动登录Token']) java.toast(\"请手动移除填写的Token\")\n    else java.toast(\"退出登录成功\");\n}\n\nfunction logToken() {\n  java.log(\n    String(\n      cookie.getKey(\n        \"fanqienovel.com\",\n        \"sessionid\"\n      )\n    ) ? String(\n     cookie.getKey(\n        \"fanqienovel.com\", \n        \"sessionid\"\n      )\n    ) : (\n     source.getLoginInfoMap()\n      ? source.getLoginInfoMap()\n      : {}\n    )['手动登录Token']\n  )\n  java.toast(\"登录Token已打印到日志，请妥善保管\")\n}\n\nfunction tutorial() {\n  java.longToast(\"\\n手动登录token功能用于部分用户的跨端登录，不知道是什么的留空就行\\n普通用户请使用下方的\\\"账号登录\\\"按钮登录自己的账号\")\n}\n\nfunction t() {\n  let gc = [\"(*^ω^*)\", \"(=^▽^=)\", \"(。’▽’。)♡\", \"٩(๑´0`๑)۶\", \"喵\", \"你好？\", \"逢考必过！\", \"早ﾉ☀\"]\n  rnd = Math.floor(Math.random() * 100)\n  if (typeof gc[rnd] != \"undefined\") {\n    java.toast(gc[rnd])\n  } else {\n    let res = JSON.parse(\n      java.ajax(\"https://v1.hitokoto.cn\")\n    )\n    java.toast(res.hitokoto)\n  }\n}\n\n// 音色设置，以及链接\nvar data = [\n    [\"阅读模式\", \"\"],\n    [\"多人对话\", \"tone_id=51\"],\n    [\"真人发音\", \"tone_id=0\"],\n    [\"甜美少女\", \"tone_id=1\"],\n    [\"清亮青叔\", \"tone_id=2\"],\n    [\"成熟大叔\", \"tone_id=4\"],\n    [\"开朗青年\", \"tone_id=5\"],\n    [\"温柔淑女\", \"tone_id=6\"],\n    [\"风雅青叔\", \"tone_id=8\"],\n    [\"清纯少女\", \"tone_id=12\"],\n    [\"磁性青叔\", \"tone_id=17\"],\n    [\"儒雅大叔\", \"tone_id=29\"],\n    [\"优雅御姐\", \"tone_id=30\"],\n    [\"斯文青叔\", \"tone_id=31\"],\n    [\"知性主播\", \"tone_id=32\"],\n    [\"成熟升级\", \"tone_id=74\"],\n    [\"多人升级\", \"tone_id=80\"],\n    [\"俏皮御姐\", \"tone_id=100\"],\n    [\"双音灵动\", \"tone_id=103\"]\n];\n\n\nvar modeNames = {3: \"小说模式\",2: \"听书模式\",8: \"漫画模式\",11: \"短剧模式\"};\n\n// 设置保存接口\nfunction set(num) {\n    if (num < 0 || num >= data.length) {\n        java.longToast(\"无效的接口编号！\");\n        return;\n    }\n    var show = \"设置成功\\n当前模式：\";\n    var tips = \"\\n‼️设置完成请点击切换模式‼️\"\n    var setData = JSON.parse(source.getVariable())\n    setData.sz = num.toString();\n    setData.tone = data[num][1];\n    source.setVariable(JSON.stringify(setData, null, \" \"));\n    var msg = show + data[num][0] + tips;\n    java.longToast(msg);\n}\n\n// 设置保存接口\nfunction set(num) {\n\tif (source.getVariable()==\"\") {\n    \n    reg(true);\n}\n    if (num < 0 || num >= data.length) {\n        java.longToast(\"无效的接口编号！\");\n        return;\n    }\n    var show = \"设置成功\\n当前模式：\";\n    var tips = \"\\n‼️设置完成请点击切换模式‼️\"\n    var setData = JSON.parse(source.getVariable())\n    \n    const currentTone = data[num][1];\n    if (currentTone === \"tone_id=0\" ) {\n        setData.module = 2;\n    } else {\n        setData.module = 3;\n    }\n    \n    setData.sz = num.toString();\n    setData.tone = currentTone;\n    source.setVariable(JSON.stringify(setData, null, \"\\t\"));\n    \n    var currentMode = setData.module || 3;\n    var msg = show + (modeNames[currentMode] || \"未知模式\") + \n              \"\\n音色设置：\" + data[num][0] + tips;\n    java.longToast(msg);\n}\n\n\n// 获取接口显示\nfunction get() {\n\tif (source.getVariable()==\"\") {\n    reg(true);\n    try {\n        var v = JSON.parse(source.getVariable() || \"{}\");\n        var currentMode = v.module || 3;\n        \n        var message = \"当前模式：\" + (modeNames[currentMode] || \"未知模式\");\n        \n        if (currentMode === 2) {\n            var sz = parseInt(v.sz || \"0\", 10);\n            var toneName = (sz >= 0 && sz < data.length) ? data[sz][0] : \"默认\";\n            message += \"\\n音色设置：\" + toneName;\n        }\n        \n        java.longToast(message);\n    } catch (e) {\n        java.longToast(\"获取模式失败：\" + e.message);\n    }\n}else{\n    try {\n        var v = JSON.parse(source.getVariable() || \"{}\");\n        var currentMode = v.module || 3;\n        \n        var message = \"\\n当前模式：\" + (modeNames[currentMode] || \"未知模式\");\n        \n        if (currentMode === 2 || currentMode === 3) {\n            var sz = parseInt(v.sz || \"0\", 10);\n            var toneName = (sz >= 0 && sz < data.length) ? data[sz][0] : \"默认\";\n            message += \"\\n音色设置：\" + toneName;\n        }\n        \n        java.longToast(message);\n    } catch (e) {\n        java.longToast(\"获取模式失败：\" + e.message);\n    }}\n}\n\n    \n\nfunction st() {\n    var v = JSON.parse(source.getVariable());\n    var mode = v.module|| 3; \n\n    var newMode;\n    if (mode === 3) {\n        newMode = 2;\n    } else\n    \n     if (mode === 2) {\n        newMode = 8;\n    } else\n    \n     if (mode === 8) {\n        newMode = 11;\n    } else\n    \n    \n     if (mode === 11) {\n        newMode = 3;\n    } else {\n        newMode = 3; \n    }\n    v.module = newMode;\n\n   \n    v.sz = \"0\";\n    v.tone = \"\";\n\n    source.setVariable(JSON.stringify(v, null, \"\\t\"));\n\n    var show = \"设置成功\\n当前模式：\";\n    var tips = \"\\n请前往详情页刷新是否切换成功\";\n    \n    \n    \n    var msg;\n\n    if (newMode === 3) {\n        msg = show + \"阅读模式\" + tips\n    } else if (newMode === 2) {\n    \t\n    \t   msg = show + \"听书模式\" + tips;\n    } else if (newMode === 8){\n    \t\n        msg = show + \"漫画模式\" + tips;\n    } else if (newMode === 11) {\n        msg = show + \"短剧模式\" + tips;\n    }\n    \n    java.longToast(msg);\n}\n\nfunction reg(is) {\n if (is) {\ntry {\nvar setData = {\n\t\"sz\": \"0\",\n\t\"tone\": \"\",\n\t\"st\": 1\n}\nsource.setVariable(JSON.stringify(setData, null, \"\\t\"));\n} catch (e) {\nvar setData = {\n\t\"sz\": \"0\",\n\t\"tone\": \"\",\n\t\"st\": 1\n}\nsource.setVariable(JSON.stringify(setData, null, \"\\t\"));\n    }\n  }\n}\n\n",
    "respondTime": 180000,
    "ruleBookInfo": {
      "author": "author",
      "canReName": "1",
      "coverUrl": "@js:java.getString(\"thumb_url\")",
      "init": "<js>\nvar model = [\n    [\"自动模式\", \"\"],\n    [\"多人对话\", \"tone_id=51\"],\n    [\"真人发音\", \"tone_id=0\"],\n    [\"甜美少女\", \"tone_id=1\"],\n    [\"清亮青叔\", \"tone_id=2\"],\n    [\"成熟大叔\", \"tone_id=4\"],\n    [\"开朗青年\", \"tone_id=5\"],\n    [\"温柔淑女\", \"tone_id=6\"],\n    [\"风雅青叔\", \"tone_id=8\"],\n    [\"清纯少女\", \"tone_id=12\"],\n    [\"磁性青叔\", \"tone_id=17\"],\n    [\"儒雅大叔\", \"tone_id=29\"],\n    [\"优雅御姐\", \"tone_id=30\"],\n    [\"斯文青叔\", \"tone_id=31\"],\n    [\"知性主播\", \"tone_id=32\"],\n    [\"成熟升级\", \"tone_id=74\"],\n    [\"多人升级\", \"tone_id=80\"],\n    [\"俏皮御姐\", \"tone_id=100\"],\n    [\"双音灵动\", \"tone_id=103\"]\n];\nvar s = JSON.parse(source.getVariable())\nif (s.st == 1) { \n   book.putVariable(\"custom\", JSON.stringify(s, null, \"\\t\"));\n   s.st = 0\n   source.setVariable(JSON.stringify(s, null, \"\\t\"));\n}\n\nfunction get(index) {\n  if (index == '4') {\n    java.longToast(\"当前模式：番茄畅听\\n本书支持真人发音\")\n  } else { \n  var v = (book.getVariable('custom') != \"\") ? book.getVariable('custom') : source.getVariable();\n    try {\n        var szStr = JSON.parse(v).sz;\n        var sz = parseInt(szStr, 10);\n        if (sz < 0 || sz >= model.length) {\n            sz = 0;\n        }\n        var show = \"当前模式：\";\n        java.longToast(show + model[sz][0]);\n    } catch (e) {\n        java.longToast(\"获取模式失败，使用默认模式。\");\n    }\n  }\n}\n\nfunction getTones(tones, run) {\n    if (run == 0) {\n    var voiceTones = tones.split(',').map(function(tone) {\n        var voice = model.find(function(item) {\n            return item[1] == `tone_id=${tone}`;\n        });\n        return voice ? voice[0] : '';\n    });\n    return voiceTones.filter(Boolean) + '\\n\\u200b\\n';\n    } \n  return ''\n}\nif (!baseUrl.includes(getHost())) {\n  result = java.ajax(java.log(\n    getHost() + \n    \"/detail?book_id=\" + \n    \tbaseUrl.match(/\\d{19}/)[0]\n   ))\n}\nvar Res  = JSON.parse(result);\nvar data = Res.page || Res.data.data;\ndata = (Array.isArray(data) ? data[0] : data.book_info) || data;\nvar type = data.genre;\njava.put(\"type\",type);\nget(type);\nvar tts_info = getTones(data.tones, data.genre);\njava.put(\"tts_info\", tts_info);\nJSON.stringify(data);\n</js>",
      "intro": "&nbsp;&nbsp;\n📕 源名：{{$.original_book_name}}\n📔 别名：{{$.book_flight_alias_name}}\n🆔 编号：{{$..book_id}}\n🗣 音色：{{$.tones}}\n📇 状态：__status__-连载{{$.creation_status}}完结\n✏️ 开坑：{{$.create_time##T|\\+.*## }}\n🕰 更新：{{java.timeFormatUTC(java.getString(\"last_chapter_update_time\")*1000,'yyyy-MM-dd HH:mm:ss',8)}}\n⌨️ 字数：{{$.word_number}}字\n📎 分类：{{$.category##/##,}}\n🏷️ 标签：🏷{{$.tags##,##🏷}}\n👤 主角：{{$.roles##\\[|\\\"|\\]}}\n📊 评分：{{$.score}}分\n👁️ 在线：{{$.read_count}}人在读\n🔗 源站：{{$..source##，.*|授权发行##}}\n🎤 音色：{{java.get('tts_info')}}\n📜 简介：\n{{$.abstract}}\n📝 书评：{{getNovelComment(java.getString(\"$.book_id\"),java.get(\"type\"))}} \n📍 {{$.copyright_info##，.*|信息##}}\n##连载0|1完结|男生0|1女生\n@js:result.replace(/....名+：\\n/g,\"\").replace(/....数+：\\n/,\"\").replace(/....评+：\\s/,\"📝 书评：无\").replace(/....色+：\\n/,\"\").replace(/....角+：\\n/,\"\").replace(/....数+：0字/,\"\").replace(\"男生2女生\",\"出版\").replace('__status__', (java.getString('$.book_search_visible') == 'true' ? '正常' : (java.getString('$.tomato_book_status') == '3' ? '下架' : '小黑屋')))\n.replace(\"连载4完结\",\"断更\")\n.replace(\"连载-1完结\",\"未知\");",
      "kind": "男生{{$.gender}}女生\n{{$.category}}\n连载{{$.creation_status}}完结\n{{$.score}}分\n{{java.timeFormatUTC(java.getString(\"last_chapter_update_time\")*1000,'yyyy-MM-dd',8)}} \n##连载0|1完结|男生0|1女生\n@js:result\n.replace(\"男生2女生\",\"出版\")\n.replace(\"连载4完结\",\"断更\")\n.replace(\"连载-1完结\",\"未知\");",
      "lastChapter": "{{$.last_chapter_title}} • {{java.timeFormat(java.getString(\"last_chapter_update_time\")*1000)}}",
      "name": "book_name",
      "tocUrl": "$.book_id\n@js:\njava.put(\"id\",result);\n\"https://fanqienovel.com/api/reader/directory/detail?bookId=\"+result",
      "wordCount": "word_number"
    },
    "ruleContent": {
      "content": "<js>\nvar item_id = java.hexDecodeToString(result);\nvar book_id = java.get('book_id');\nvar type = String(java.get('type'));\njava.log(type)\nvar v = JSON.parse((book.getVariable('custom') != \"\") ? book.getVariable('custom') : source.getVariable());\nvar sz = v.sz;\nvar tone = v.tone;\n\nif (type == 1) {\n  book.type = 64;\n} else if (type == 4 || sz != 0) {\n  book.type = 32;\n} else {\n  book.type = 8;\n}\n\nif (type == 4 || sz != 0) {\n    if (type == 4) {\n    url = getHost() + `/api/index.php?api=content&ts=听书&tone_id=1&item_ids=${item_id}`; \n} else if (sz != 0) {\n    url = getHost() + `/api/index.php?api=content&ts=听书&${tone}&item_ids=${item_id}`; \n}\n  try {\n    result = JSON.parse(java.ajax(url)).data.content; \n  } catch(e) { result = \"该书不支持当前音色，请更换并刷新\"; }\n} else if (type == 203) {\n  surl = getHost() + `/api/index.php?api=video&ts=短剧&item_id=${item_id}`; \n  param = {\"biz_param\":{\"device_level\":3,\"need_all_video_definition\":false,\"need_mp4_align\":false,\"use_os_player\":false,\"video_platform\":1024},\"video_id\": item_id} \n  head = {\n    \"body\": JSON.stringify(param),\n    \"method\": \"POST\",\n    \"headers\": {\n      \"User-Agent\": \"com.dragon.read/65532 (Linux; U; Android 13; zh_CN; PHY120; Build/TP1A.220905.001; Cronet/TTNetVersion:b2888ab3 2024-06-12 QuicVersion:1886aac1 2023-11-17)\"\n    }\n  }\n  murl = surl + JSON.stringify(head)\n  try {\nresult = JSON.parse(java.ajax(surl)).data.video_url;\nif(book.durChapterIndex == chapter.index) {\n\t\tjava.startBrowser(`data:text/html;charset=utf-8,<html><title>${chapter.title}</title><style>body {background-color: black;} video {position: fixed; top: 0; left: 0; width: 100%; height: 100%;}</style><body><video controls><source src=\"${result}\" type=\"video/mp4\"></video></body></html>`, chapter.title)\n\t\tjava.toast('正在加载视频\\n视频加载较慢，请耐心等待')\n\t }\n  result = '【刷新正文】播放\\n直链:\\n'+result\n  } catch(e) { result = '视频获取失败，尝试重新获取' }\n} else if (type == 1) \n{\nlet url = getHost() + '/api/index.php?api=manga&item_ids=' + item_id;\njava.log(url)\npi = JSON.parse(java.ajax(url)).data.images\nresult = pi.map(i=> `<img src=\"${i}\">`).join(\"\\n\")\n}else{\nlet url = getHost() + '/api/index.php?api=content&item_ids=' + item_id;\n java.log(url)\nlet res = JSON.parse(java.ajax(url));\n\nfunction getContent(response) {\n    if (response.success && response.data && Array.isArray(response.data) && response.data[0] && response.data[0].content) {\n        return response.data[0].content;\n    }\n    else if (response.data && response.data.content) {\n        let mat = response.data.content.match(/<article>([\\s\\S]*?)<\\/article>/); \n        try {\n            let cnt = JSON.parse(\n                mat\n                    ? mat[1].replace(/\\&/g, '\"').replace(/\\;/g, \"\").replace(/\\#34/g, \"\")\n                    : response.data.content\n            );\n            return (mat ? cnt.skeleton.data : cnt.picInfos)\n                .map((i) => {\n                    let path = mat\n                        ? cnt.materials[i.element_name].data.web_uri\n                        : \"novel-pic/\" + i.md5;\n                    return `<img src=\"https://p6-novel.byteimg.com/origin/${path}\">`;\n                })\n                .join(\"<br>\");\n        } catch (e) {\n            mat = response.data.content.match(/<body>([\\s\\S]*?)<\\/body>/) \n            return (mat ? mat[1] : response.data.content).toString()\n                .replace(/\\<\\!DOCTYPE html.*/g, \"\")\n                .replace(/\\<tt_keyword_ad.*\\<\\/tt_keyword_ad\\>/, \"\")\n                .replace(/\\<a epub.*\\>\\<\\/a\\>/g, \"\");\n        }\n    }\n    return \"无法识别的数据格式，预计半小时恢复正常！(看到这提示就意味有人又在作死下载书籍了！)\";\n}\n\nresult = getContent(res);\n}\nresult\n</js>"
    },
    "ruleExplore": {
      "author": "$.author",
      "bookList": "<js>\nfunction getBookIdFull(url) {\n\tconst {java} = this\n\t$ = JSON.parse(url).data\n\tif ($.book_shelf_info != 0 && $.book_shelf_info != undefined) {\n\t\tarr = $.book_shelf_info.map($ => $.book_id)\n\t} else if (list = $.data_list != 0 && $.data_list != undefined)  {\n\t\tarr = $.data_list.map($ => $.book_id_str)\n\t} else {\n\t\tjava.toast(\"获取 book_id 失败，你可能需要登录！\")\n\t}\n\treturn arr\n}\nlet ck = \"sessionid=\" + (String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) ? String(cookie.getKey(\"fanqienovel.com\", \"sessionid\")) : (source.getLoginInfoMap() ? source.getLoginInfoMap() : {})['手动登录Token'])\n\ngetShelf = () => {\nlet book_shelf_url = 'https://fanqienovel.com/reading/bookapi/bookshelf/info/v:version/?aid=1967&iid=0&version_code=57700&update_version_code=57700'\nlet book_shelf_info = java.ajax(book_shelf_url + ', ' + JSON.stringify({\n  headers: {\n    'Cookie': ck\n  }\n}))\n\nbid = getBookIdFull(book_shelf_info)\nlet id_list = splitArray(bid, 100)\nlet urls = []\nid_list.forEach(i => {\n    urls.push(getApi() + \"/multi-detail?book_id=\" + i.join(\",\"))\n})\n\nres = java.ajaxAll(urls)\n\nlet resp = {book_info: []}\nres.forEach(r => {\n  resp.book_info = resp.book_info.concat(JSON.parse(r.body()).data)\n})\n\nreturn resp\n}\n\nfunction getByGroupName(name) {\n  let book_shelf_url = 'https://fanqienovel.com/reading/bookapi/bookshelf/info/v:version/?aid=1967&iid=0&version_code=57700&update_version_code=57700'\n\n  let book_shelf_info = JSON.parse(java.ajax(book_shelf_url + ', ' + JSON.stringify({\n    headers: {\n      'Cookie': ck,\n    }\n  })))\n  let group_bookids = {\n    \"未分组\": []\n  }\n  // java.log(\n  book_shelf_info.data.book_shelf_info.forEach(i => {\n    if (!group_bookids[i.group_name ? i.group_name : \"未分组\"]) group_bookids[i.group_name] = []\n    group_bookids[i.group_name ? i.group_name : \"未分组\"].push(i.book_id)\n  })\n  // java.log(JSON.stringify(group_bookids[\"未分组\"]))\n  // java.log(decodeURIComponent(name))\n  if (!group_bookids[decodeURIComponent(name)]) return {data: []}\n  //java.log(\"awa\")\n  let book_ids = splitArray(group_bookids[decodeURIComponent(name)], 100)\n  let urls = []\n\n  book_ids.forEach(i => {\n    urls.push(getApi() + \"/multi-detail?book_id=\" + i.join(\",\"))\n  })\n  java.log(urls)\n  res = java.ajaxAll(urls)\n\n  let resp = {book_info: []}\n  res.forEach(r => {\n    resp.book_info = resp.book_info.concat(JSON.parse(r.body()).data)\n  })\n\n  return resp\n}\n\nfunction getByTabIndex(index) {\n  let url = _mlsec.requestHeader(\n\t  \"bookmall/tab\",\n    \"version_name=5.8.9.32\",\n\t  null,\n\t  ck\n  )\n  let all = JSON.parse(java.ajax(url))\n  let tab = all.data.tab_item[0].cell_data[index].cell_data\n  if (!tab) tab = []\n  let bookList = []\n  for (let i of tab) {\n    bookList = bookList.concat(i.book_data)\n    // java.log(JSON.stringify(i.book_data))\n  }\n  return { book_info: bookList }\n}\n\nif (baseUrl.endsWith(\"bookshelf\")) result = getShelf(\"bookshelf/info\")\nelse if(/read_history/.test(baseUrl)) {\n  bid = getBookIdFull(result);\n  id_list = splitArray(bid, 100);\n  let urls = [];\n  id_list.forEach(i => {\nurls.push(getApi() + \"/multi-detail?book_id=\" + i.join(\",\"))\n});\n  let resp = {book_info: []}\n  urls.forEach(r => {\n    resp.book_info = resp.book_info.concat(JSON.parse(java.ajax(r)).data)\n  })\n  result = resp;\n} else {\n  let w = baseUrl.split(\"/\")\n  if (baseUrl.includes(\"groupName\")) {\n    result = getByGroupName(w[w.length - 1])\n  } else if (baseUrl.includes(\"tab\")) {\n    result = getByTabIndex(parseInt(w[w.length - 1]))\n  } else result = JSON.parse(result)\n}\nJSON.stringify({data: result.book_info || result.data.book_info || result.detail_list || result.data})\n</js>\n$.data[*]",
      "bookUrl": "{{getHost()}}/api/index.php?api=content&book_id={{$.book_id||$.series_id}}",
      "coverUrl": "@js:java.getString(\"thumb_url\")",
      "intro": "$.abstract##\\n",
      "kind": "男生{{$.gender}}女生\n连载{{$.creation_status}}完结\n{{$.score}}分\n{{$..text}}\n{{$.sub_info}}\n##连载0|1完结|男生0|1女生|男生女生[\\s\\S]*\n@js:result\n.replace(\"男生2女生\",\"出版\")\n.replace(\"连载4完结\",\"断更\")\n.replace(\"连载-1完结\",\"未知\");",
      "name": "$.book_name",
      "wordCount": "$.word_number"
    },
    "ruleSearch": {
      "author": "author||$..copyright",
      "bookList": "<js>\nlet list = [];\nlet book_list = [];\nlet res = JSON.parse(result);\n\ntry {\n  if (res.data.search_tabs) {\n    for (let i = 0; i < res.data.search_tabs.length; i++) {\n        let books = res[\"data\"][\"search_tabs\"][i][\"data\"];\n        if (books != null) list = list.concat(books);\n    }\n  }\n} catch (e) {}\n\nfor (let $ of list) {\n   book_list.push($.book_data ? $.book_data[0] : ($.video_data ? $.video_data[0] : $));\n}\n\nJSON.stringify(book_list)\n</js>$[*]",
      "bookUrl": "{{getHost()}}/api/index.php?api=content&book_id={{$.book_id||$.series_id}}",
      "checkKeyWord": "m:末世",
      "coverUrl": "@js:java.getString(\"thumb_url||cover\")",
      "intro": "abstract||$..series_intro##\\n",
      "kind": "男生{{$.gender}}女生\n连载{{$.creation_status}}完结\n{{$.score}}分\n{{$..text}}\n{{$.sub_info}}\n##连载0|1完结|男生0|1女生|男生女生[\\s\\S]*\n@js:result\n.replace(\"男生2女生\",\"出版\")\n.replace(\"连载4完结\",\"断更\")\n.replace(\"连载-1完结\",\"未知\");",
      "lastChapter": "sub_title",
      "name": "book_name||$..series_title##（别名：.*?）",
      "wordCount": "word_number"
    },
    "ruleToc": {
      "chapterList": "<js>\nvar type = java.get('type');\nvar v = (book.getVariable('custom') != \"\") ? book.getVariable('custom') : source.getVariable();\nvar sz = JSON.parse(v).sz;\nif (type == 1) {\n  book.type = 64;\n} else if (type == 4 || sz != 0) {\n  book.type = 32;\n} else {\n  book.type = 8;\n}\nresult\n</js>$.data.chapterListWithVolume[*].[*]",
      "chapterName": "$.title",
      "chapterUrl": "$.itemId\n<js>java.base64Encode(result)</js>\ndata:;base64,{{result}},{\"type\":\"fqpyc\"}",
      "updateTime": "{{$.volume_name}} | {{java.timeFormatUTC(java.getString(\"firstPassTime\") * 1000, 'yyyy-MM-dd HH:mm:ss', 28800000)}}##第一卷：默认\n@js:\nif (result.startsWith(\" |\")) result = result.slice(2)\nif (result.startsWith(\"| \")) result = result.slice(2)\nresult"
    },
    "searchUrl": "@js:\nvar r = {\n\t\"sourl\": \"https://fq.xo0x.cn\",\n\t\"type\": \"小说模式\",\n\t\"module\":\"3\",\n\t\t\"sz\": \"0\",\n\t\"tone\": \"\"\n\t\n};\nif (source.getVariable()==\"\") {\n \n    source.setVariable(JSON.stringify(r, null, \"\\t\"));\n    java.toast('\\n已初始化，使用默认站源');\n}\nmodule=JSON.parse(source.getVariable()).module;\n\n\ntab = + module\nif(tab == 3) java.put(\"i\", \"5\")\nif (String(key).startsWith(\"m:\")||String(key).startsWith(\"m：\")) {\n  tab = 8\n  key = key.slice(2)\n}\nif (String(key).startsWith(\"t:\")||String(key).startsWith(\"t：\")) {\n  tab = 2\n  key = key.slice(2)\n}\nif (String(key).startsWith(\"d:\")||String(key).startsWith(\"d：\")) {\n  tab = 11\n  key = key.slice(2)\n}\n\nif (key.length == 19 && !Number.isNaN(parseInt(key))) {\n  result = getHost() + '/api/index.php?api=content&book_id=' + key\n} else {\nresult = getHost() + '/api/index.php?api=search&key=' + encodeURI(java.put(\"key\", key)) + '&offset=' + ((java.put(\"page\", page) - 1) * 10) + '&tab_type=' + tab\n}\nresult",
    "weight": 0
  }
]